---
title: "eQTL_Stroke_MatrixEQTL_mRNA_032519"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#by checking the coding type of the probset ID (TC) in "gene_expression_annotation_351.SST-RMA-GENE-FULL - Group 1", found some of them as a non-coding RNA, snoRNA, lncRNA. So in this script we want to filter genes based on biotype == mRNA to see as a real coding genes

```{r}
#cat gene_expression_annotation_351.SST-RMA-GENE-FULL\ -\ Group\ 1.TXT | grep "mRNA" > gene_expression_annotation_351.SST-RMA_mRNA_like.txt, then remove mRNA like such as lncoding RNA by keeping only mRNA and set the new output's name to gene_expression_annotation_351.SST-RMA_mRNA.txt #(27337 genes)
gene_expression_annotation_351.SST.RMA_mRNA.txt <- read.delim("C:/eQTL/GENE/Picked_Files/gene_expression_351/gene_expression_annotation_351.SST-RMA_mRNA.txt.csv", row.names=1) #20328 364
colnames(gene_expression_annotation_351.SST.RMA_mRNA.txt) <- sub(x = colnames(gene_expression_annotation_351.SST.RMA_mRNA.txt), pattern = "_HTA*.*", replacement ="") 
gene_expression_annotation_351.SST.RMA_mRNA_small <- gene_expression_annotation_351.SST.RMA_mRNA.txt[,c(1:351)] # dim 20328 351
GE<- gene_expression_annotation_351.SST.RMA_mRNA_small[,c(-1,-2,-3)] # 20328   351
write.table(gene_expression_annotation_351.SST.RMA_mRNA_small, file = "../../Input_Output/GE_mRNA_20328.txt",col.names =T, sep = "\t") 
```

```{r}
expression_file_name = paste(base.dir, "/Input_Output/GE_mRNA_20328.txt", sep="") 
#back to other script to run eQTL function for this GE dataset
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e6.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e6.csv")

```


```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_cis_dist_1e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e6.csv")
#load( "../Input_Output/RData/gene_expression_annotation_SNP_calls_small.RData")
eQTL_cis_dist_1e6_merge <- merge(eQTL_cis_dist_1e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #62

eQTL_cis_dist_1e6_merge_v2 <- merge(eQTL_cis_dist_1e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#62
write.csv(eQTL_cis_dist_1e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e6_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_trans_1e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e6.csv")
eQTL_trans_1e6_merge <- merge(eQTL_trans_1e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #33

eQTL_trans_1e6_merge_v2 <- merge(eQTL_trans_1e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#33
write.csv(eQTL_trans_1e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e6_merge.csv")
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_5e5.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_5e5.csv")
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e7.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e7.csv")

```


```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_cis_dist_1e7 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e7.csv")
#load( "../Input_Output/RData/gene_expression_annotation_SNP_calls_small.RData")
eQTL_cis_dist_1e7_merge <- merge(eQTL_cis_dist_1e7,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #513

eQTL_cis_dist_1e7_merge_v2 <- merge(eQTL_cis_dist_1e7_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#513
write.csv(eQTL_cis_dist_1e7_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e7_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_trans_1e7 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e7.csv")
eQTL_trans_1e7_merge <- merge(eQTL_trans_1e7,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #33

eQTL_trans_1e7_merge_v2 <- merge(eQTL_trans_1e7_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#33
write.csv(eQTL_trans_1e7_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e7_merge.csv")
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_5e6.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_5e6.csv")

```


```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_cis_dist_5e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_5e6.csv")
#load( "../Input_Output/RData/gene_expression_annotation_SNP_calls_small.RData")
eQTL_cis_dist_5e6_merge <- merge(eQTL_cis_dist_5e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #296

eQTL_cis_dist_5e6_merge_v2 <- merge(eQTL_cis_dist_5e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#62
write.csv(eQTL_cis_dist_5e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_5e6_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_trans_5e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_5e6.csv")
eQTL_trans_5e6_merge <- merge(eQTL_trans_5e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #33

eQTL_trans_5e6_merge_v2 <- merge(eQTL_trans_5e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#33
write.csv(eQTL_trans_5e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_5e6_merge.csv")
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_5e5.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_5e5.csv")
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_2e7.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_2e7.csv")

```


```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_cis_dist_2e7 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_2e7.csv")
#load( "../Input_Output/RData/gene_expression_annotation_SNP_calls_small.RData")
eQTL_cis_dist_2e7_merge <- merge(eQTL_cis_dist_2e7,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #876

eQTL_cis_dist_2e7_merge_v2 <- merge(eQTL_cis_dist_2e7_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#876
write.csv(eQTL_cis_dist_2e7_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_2e7_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_trans_2e7 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_2e7.csv")
eQTL_trans_2e7_merge <- merge(eQTL_trans_2e7,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #33

eQTL_trans_2e7_merge_v2 <- merge(eQTL_trans_2e7_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#33
write.csv(eQTL_trans_2e7_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_2e7_merge.csv")
```


```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_5e7.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_5e7.csv")
#merge the file like others
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e8.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e8.csv")

```


```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_cis_dist_1e8 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e8.csv")
#load( "../Input_Output/RData/gene_expression_annotation_SNP_calls_small.RData")
eQTL_cis_dist_1e8_merge <- merge(eQTL_cis_dist_1e8,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #2667

eQTL_cis_dist_1e8_merge_v2 <- merge(eQTL_cis_dist_1e8_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#2667
write.csv(eQTL_cis_dist_1e8_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_1e8_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_trans_1e8 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e8.csv")
eQTL_trans_1e8_merge <- merge(eQTL_trans_1e8,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #29

eQTL_trans_1e8_merge_v2 <- merge(eQTL_trans_1e8_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#29
write.csv(eQTL_trans_1e8_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_1e8_merge.csv")
```

```{r}
write.csv(eQTL$cis$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_2e6.csv")
write.csv(eQTL$trans$eqtls, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_2e6.csv")

```


```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_cis_dist_2e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_2e6.csv")
#load( "../Input_Output/RData/gene_expression_annotation_SNP_calls_small.RData")
eQTL_cis_dist_2e6_merge <- merge(eQTL_cis_dist_2e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #114

eQTL_cis_dist_2e6_merge_v2 <- merge(eQTL_cis_dist_2e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#114
write.csv(eQTL_cis_dist_2e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_cis_dist_2e6_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
#start with coding folder
eQTL_trans_2e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_2e6.csv")
eQTL_trans_2e6_merge <- merge(eQTL_trans_2e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #33

eQTL_trans_2e6_merge_v2 <- merge(eQTL_trans_2e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#33
write.csv(eQTL_trans_2e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/eQTL_trans_2e6_merge.csv")
```

# redo analysis for x-linked and y-linked genes from mRNA list not all coding and noncoding genes 

```{r}
#cat gene_expression_annotation_351.SST-RMA-GENE-FULL\ -\ Group\ 1.TXT | grep "mRNA" > gene_expression_annotation_351.SST-RMA_mRNA_like.txt, then remove mRNA like such as lncoding RNA by keeping only mRNA and set the new output's name to gene_expression_annotation_351.SST-RMA_mRNA.txt #(27337 genes)
gene_expression_annotation_351.SST.RMA_mRNA_sex <- read.csv("C:/eQTL/GENE/Picked_Files/gene_expression_351/gene_expression_annotation_351.SST-RMA_mRNA_sex.csv", row.names=1) #898 364

colnames(gene_expression_annotation_351.SST.RMA_mRNA_sex) <- sub(x = colnames(gene_expression_annotation_351.SST.RMA_mRNA_sex), pattern = "_HTA*.*", replacement ="") 
GE <- gene_expression_annotation_351.SST.RMA_mRNA_sex[,c(1:351)] # dim 898 351
write.table(GE, file = "../../Input_Output/GE_mRNA_sex_898.txt",col.names =T, sep = "\t") 
```


```{r}
expression_file_name = paste(base.dir, "/Input_Output/GE_mRNA_sex_898.txt", sep="") 
#back to other script to run eQTL function for this GE dataset
```

```{r}
write.csv(eQTL$trans$eqtls, "../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_5e6.csv")
write.csv(eQTL$cis$eqtls, "../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dis_5e6.csv")
```

```{r}
#sex folder in mRNA folder to compare with another sex folder
eQTL_cis_dist_1e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex//eQTL_cis_dist_1e6.csv") #1
eQTL_cis_dist_1e6_merge <- merge(eQTL_cis_dist_1e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #1

eQTL_cis_dist_1e6_merge_v2 <- merge(eQTL_cis_dist_1e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#62
write.csv(eQTL_cis_dist_1e6_merge_v2,"../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_1e6_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
eQTL_trans_1e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_1e6.csv") #5
eQTL_trans_1e6_merge <- merge(eQTL_trans_1e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #5

eQTL_trans_1e6_merge_v2 <- merge(eQTL_trans_1e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#5
write.csv(eQTL_trans_1e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_1e6_merge.csv") 
```

```{r}
#sex folder in mRNA folder to compare with another sex folder
eQTL_cis_dist_2e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_2e6.csv") #3
eQTL_cis_dist_2e6_merge <- merge(eQTL_cis_dist_2e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #3

eQTL_cis_dist_2e6_merge_v2 <- merge(eQTL_cis_dist_2e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#62
write.csv(eQTL_cis_dist_2e6_merge_v2,"../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_2e6_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
eQTL_trans_2e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_2e6.csv") #5
eQTL_trans_2e6_merge <- merge(eQTL_trans_2e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #5

eQTL_trans_2e6_merge_v2 <- merge(eQTL_trans_2e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#5
write.csv(eQTL_trans_2e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_2e6_merge.csv")
```

```{r}
#sex folder in mRNA folder to compare with another sex folder
eQTL_cis_dist_5e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_5e6.csv") #6
eQTL_cis_dist_5e6_merge <- merge(eQTL_cis_dist_5e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #6

eQTL_cis_dist_5e6_merge_v2 <- merge(eQTL_cis_dist_5e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#6
write.csv(eQTL_cis_dist_5e6_merge_v2,"../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_5e6_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
eQTL_trans_5e6 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_5e6.csv") #5
eQTL_trans_5e6_merge <- merge(eQTL_trans_5e6,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #5

eQTL_trans_5e6_merge_v2 <- merge(eQTL_trans_5e6_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#5
write.csv(eQTL_trans_5e6_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_5e6_merge.csv")
```

```{r}
#sex folder in mRNA folder to compare with another sex folder
eQTL_cis_dist_1e7 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_1e7.csv") #6
eQTL_cis_dist_1e7_merge <- merge(eQTL_cis_dist_1e7,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #6

eQTL_cis_dist_1e7_merge_v2 <- merge(eQTL_cis_dist_1e7_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#6
write.csv(eQTL_cis_dist_1e7_merge_v2,"../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_cis_dist_1e7_merge.csv")
```

```{r}
#merge two dataframe to add more info. on the final result (eQTL_step*)
eQTL_trans_1e7 <- read.csv("C:/eQTL/R_eQTL_Stroke/Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_1e7.csv") #5
eQTL_trans_1e7_merge <- merge(eQTL_trans_1e7,gene_expression_annotation_small,by ="gene", all.x = TRUE, sort =TRUE) #5

eQTL_trans_1e7_merge_v2 <- merge(eQTL_trans_1e7_merge ,SNP_calls_small, by = "snps", all.x = TRUE, sort = TRUE)#5
write.csv(eQTL_trans_1e7_merge_v2, "../../Input_Output/eQTL_result/LINEAR_CROSS/mRNA/sex/eQTL_trans_1e7_merge.csv")
```

```{r}
#save the SNP and expression matrix which ws used for final analysis
#SNP_CRmore95_MAFmore0.05_HWEmore0.0000005 <- read.delim("C:/eQTL/R_eQTL_Stroke/Input_Output/SNP_CRmore95_MAFmore0.05_HWEmore0.0000005.txt", row.names=1)
#GE_mRNA_20328 <- read.delim("C:/eQTL/R_eQTL_Stroke/Input_Output/GE_mRNA_20328.txt", row.names=1)
#Covariates_Final_No_PC_NO_Subtype <- read.delim("C:/eQTL/R_eQTL_Stroke/Input_Output/Covariates_Final_No_PC_NO_Subtype.txt", row.names=1)
save(GE_mRNA_20328, SNP_CRmore95_MAFmore0.05_HWEmore0.0000005, file = "../../Input_Output/RData/GE_mRNA_SNP_CRmore95_MAFmore0.05_HWEmore0.0000005.RData")
```

```{r}
#compare lm() result with MatrixeQTL function "https://rdrr.io/cran/MatrixEQTL/man/modelLINEAR_CROSS.html"
#snp <- as.matrix(SNP_CRmore95_MAFmore0.05_HWEmore0.0000005)
#ge <- as.matrix(GE_mRNA_20328)
#cvr <-as.matrix(Covariates_Final_No_PC_NO_Subtype)
#for lm() finction needs to transpose dataset
#snps.mat <- t(snp) # 351 273688
#gene.mat <-t(ge) #  351 20328
#cvrt.mat <- t(cvr) #351 4
# snps.mat2 <- as.matrix(snps.mat[,1])
# class(snps.mat2)
# gene.mat2 <- as.matrix(gene.mat[,1])


beta = eQTL$all$eqtls$beta;
tstat = eQTL$all$eqtls$statistic;
pvalue = eQTL$all$eqtls$pvalue;
rez = c(beta = beta, tstat = tstat, pvalue = pvalue)
# And compare to those from the linear regression in R
{
    cat('\n\n Matrix eQTL: \n'); 
    print(rez);
    cat('\n R summary(lm()) output: \n')
   lmodel = lm(gene.mat2~ snps.mat2 + cvrt.mat + snps.mat2*cvrt.mat); 
                   
    lmout = tail(summary(lmodel)$coefficients,1)[, c("Estimate", "t value", "Pr(>|t|)")];
    print( tail(lmout) );
}
# Results from Matrix eQTL and 'lm' must agree
stopifnot(all.equal(lmout, rez, check.attributes = FALSE));
#should see something like as follows:
#  Matrix eQTL: 
#         beta        tstat       pvalue 
# 1.092349e+00 1.258344e+01 2.844406e-08 
# 
#  R summary(lm()) output: 
#     Estimate      t value     Pr(>|t|) 
# 1.092349e+00 1.258344e+01 2.844406e-08 
```

```{r}
par(mfrow=c(2,2))
plot(lmodel)
abline(lmodel)
```

```{r}
cvrt2 <- as.data.frame(cvrt.mat)
cvrt.stroke <- cvrt2[cvrt2$diagnosis == 4,] #subset only stroke group #183
cvrt.control <- cvrt2[cvrt2$diagnosis == 1,] #subset only control group #168
snps.mat2.stroke <-as.matrix(snps.mat2[rownames(cvrt.stroke),])
snps.mat2.control <-as.matrix(snps.mat2[rownames(cvrt.control),])
gene.mat2.stroke <-as.matrix(gene.mat2[rownames(cvrt.stroke),])
gene.mat2.control <-as.matrix(gene.mat2[rownames(cvrt.control),])

```

